<h1>API Files</h1>
<p>
	Choosing an API type file, use the dialog opion '<blue>API File (Server side execute template)</blue>', set the file as a JavaScript file extension. Make sure the website settings have the file location defined as a dynamic or fixed API, or set as an static override file. This will ensure the API is executed on the server side and not sent to client browser.
</p>
<br />
<img src="../../images/4_file_create_dialog_api.png" alt="" />
<br /><br />
<p>
	API file types are predefined code to work with this system. They are marked commented sections (<hl>highlighted</hl> below) where you can put in your own code. In Node.js, there is ECMAScript and CommonJS. This version of server uses CommonJS syntax. ECMAScript format is currently being tested on a parallel version. Both formats cannot be run at the same time on the same server.
	<br /><br />
	There is a predefined '<blue>exports.request</blue>' function used by the server to call your API. At the bottom of the function is a '<blue>return _response;</blue>' line that the server will use to get status code, any added headers, and the response body in whichever preferred format. Just note, the '<blue>Content-Type</blue>' header would need to be updated as per the response body. Under the '<blue>exports.request</blue>' function there are some default functions '<blue>_error</blue>' amd the '<blue>_return</blue>' function. You can add additional functions to the bottom of the file as you see fit if not choosing to write and import a class object.
	<br /><br />
	Regarding Node modules, you can install them in your project folder and import them at the top of the API file. There is no need to modify the server files in any way to make them global to the environment. This is meant to keep the complexity low for the overall system and only load modules you need for your project.
	<br /><br />
	There are parameters that are sent to the request function that are generated by the server as follows. Near bottom of page is a sample output of the API file template. These are the top level parameters.
</p>
<ul>
	<li><b>_env</b> is the server environment variable</li>
	<li><b>_server</b> details about the server, environment and environment name, IP addresses, node version, etc</li>
	<li><b>_client</b> details about the client. IP address, X-Forward-For IP, user agent, cookie</li>
	<li><b>_headers</b> headers from the client</li>
	<li><b>_request</b> parsed URL, method, http version, paths, query and special fields from fixed APIs (trailing parsed path)</li>
	<li><b>_query</b> pre-parsed query string and any JSON fields</li>
</ul>
<br />
<img src="../../images/4_file_type_api.png" alt="" />
<br /><br />
<h3>Default API File Response</h3>
<p>
	The following is an example of the API default output of what the server provides (taken from the <hl_green>green</hl_green> highlight above). POST method may exclude some query details from URI path as it uses post query field values like a form or other posted query string.
	<br /><br />
	<b>Example URL:</b><br />
	https://localhost/vhost/project_name::example3/api/get?query=something&json={"key":"value"}
</p>
<pre>
   {
      "_env": "dev",
      "_server": {
        "local_ipv4": "192.168.1.5",
        "local_ipv6": "fe80::29a7:31dc:23fb:8920",
        "request_ip": "localhost",
        "node_version": "v20.11.1",
        "environment": "dev",
        "environment_name": "testing"
      },
      "_client": {
        "remote_ip": "localhost",
        "remote_ip_xff": null,
        "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36",
        "cookie": null
      },
      "_headers": {
        "Host": "localhost",
        "Connection": "keep-alive",
        "sec-ch-ua": "\"Chromium\";v=\"128\", \"Not;A=Brand\";v=\"24\", \"Google Chrome\";v=\"128\"",
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "\"Windows\"",
        "Upgrade-Insecure-Requests": "1",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
        "Sec-Fetch-Site": "none",
        "Sec-Fetch-Mode": "navigate",
        "Sec-Fetch-User": "?1",
        "Sec-Fetch-Dest": "document",
        "Accept-Encoding": "gzip, deflate, br, zstd",
        "Accept-Language": "en-US,en;q=0.9"
      },
      "_request": {
        "method": "GET",
        "http_version": "1.1",
        "protocol": "https",
        "hostname": "localhost",
        "path": "/vhost/project_name::example3/api/get",
        "path_prefix": "/vhost/project_name::example3/",
        "path_suffix": "/api/get/",
        "query_string": "query=something&json={%22key%22:%22value%22}",
        "fixed_api_path": []
      },
      "_query": {
        "query": "something",
        "json": {
         "key": "value"
        }
      }
     }
</pre>
<br />
<br />
<br />
<br />
<br />
<br />